---
layout: topic
title: Data visualisation with R 
minutes: 60
---

```{r, echo=FALSE, purl=FALSE}
knitr::opts_chunk$set(fig.keep='none')
```

Visualising data in R with ggplot2 package

#### Disclaimer

We will here using functions of ggplot2 package. There are basic ploting capabilities
in basic R, but ggplot2 adds more powerful plotting capabilities.

> ## Learning Objectives
>
> * Visualise some of the [mammals data](http://figshare.com/articles/Portal_Project_Teaching_Database/1314459) from Figshare [surveys.csv](http://files.figshare.com/1919744/surveys.csv)
> * Understand how to plot these data using R ggplot2 package. For more details on using ggplot2 see [official documentation](http://docs.ggplot2.org/current/).
> * Building step by step complex plots with ggplot2 package

Load required packages
```r
# plotting package
library(ggplot2)
# piping / chaining
library(magrittr)
# modern dataframe manipulations
library(dplyr)
```

Load data directly from figshare.
```r
surveys <- read.csv("http://files.figshare.com/1919744/surveys.csv")
```
`surveys.csv` data contains some measurements of the animals caught in plots.
Make simple scatter plot of `hindfoot_length` (in millimeters) as a function of `weight`
(in grams), using basic R plotting capabilities.
```r
plot(x=surveys$weight, y=surveys$hindfoot_length)
```
Make the same plot using `ggplot2` package
```r
ggplot(surveys, aes(weight, hindfoot_length)) +
            geom_point()
```
In ggplot first 
```r
surveys %>% ggplot(aes(weight, hindfoot_length)) +
            stat_binhex(bins=50) +
            scale_fill_gradientn(trans="log10",
                                 colours = heat.colors(10, alpha=0.5))
# there are a lot of species with low counts,
# lets make a barpolot and see
species_counts <- surveys %>% 
                  filter(!is.na(weight)) %>%
                  group_by(species_id) %>%
                  summarise(n=n())
                  
surveys %>% ggplot(aes(factor(species_id))) +
                   geom_bar() +
                   scale_y_continuous(trans = 'log10')


high_counts <- species_counts %>%
                      filter(n > 10) %>%
                      select(species_id)
                      
surveys_subset <- surveys %>%
                  filter(species_id %in% high_counts$species_id)

surveys_subset %>% ggplot(aes(factor(species_id), weight)) +
                   geom_boxplot()

# add jitter to see how many points are per boxplot
surveys_subset %>% ggplot(aes(factor(species_id), weight)) +
                   geom_boxplot() +                  
                   geom_jitter(alpha=0.1)
                   
# different way to look at it is violoin plot                 
surveys_subset %>% ggplot(aes(factor(species_id), weight)) +
                   geom_violin()        
                   
# challange would be do the same for length  

# counts in time per species

# remove unannotated species
surveys_subset %<>% filter(species_id != "")
# summarise counts per year per species
yearly_counts <- surveys_subset %>%
                 group_by(year, species_id) %>%
                 summarise(count=n())

yearly_counts %>% ggplot(aes(x=year,
                             y=count,
                             group=species_id,
                             color=species_id)) +
                  geom_line()
                  
yearly_counts %>% ggplot(aes(x=year,
                             y=count,
                             color=species_id)) +
                  geom_line()

yearly_counts %>% ggplot(aes(x=year,
                             y=count,
                             color=species_id)) +
                  geom_line() +
                  facet_wrap(~species_id)

```
